<!DOCTYPE html>
<html>
<head>
    <title>SPACE TYCOON: STATION BUILDER</title>
    <style>
        :root { --neon-blue: #00f2ff; --neon-pink: #ff0077; --gold: #ffcc00; }
        body { margin: 0; overflow: hidden; background: #1a1a2e; font-family: 'Segoe UI', sans-serif; }
        
        #ui { position: absolute; top: 20px; left: 20px; color: white; background: rgba(0, 0, 0, 0.4); 
               padding: 20px; border-radius: 15px; border: 2px solid var(--neon-blue); backdrop-filter: blur(5px); pointer-events: none; }
        #money { font-size: 36px; color: #00ff88; font-weight: bold; }
        .label { font-size: 12px; font-weight: bold; color: var(--neon-blue); text-transform: uppercase; }
        
        /* Floating Price Labels */
        .price-tag { position: absolute; color: white; background: rgba(0,0,0,0.8); padding: 5px 10px; 
                     border-radius: 5px; border: 1px solid var(--neon-pink); font-weight: bold; pointer-events: none;
                     transform: translate(-50%, -50%); }
    </style>
</head>
<body>

    <div id="ui">
        <div class="label">Space Station Credits</div>
        <div id="money">§ 50</div>
        <div id="income" style="font-size: 14px; color: white;">Income: §0/sec</div>
    </div>

    <div id="labels-container"></div>

    <script type="importmap">
        { "imports": { "three": "https://unpkg.com/three@0.160.0/build/three.module.js" } }
    </script>

    <script type="module">
        import * as THREE from 'three';

        // --- SCENE SETUP ---
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x1a1a2e);
        scene.fog = new THREE.Fog(0x1a1a2e, 20, 150);

        const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // --- LIGHTING ---
        scene.add(new THREE.AmbientLight(0xffffff, 0.7));
        const sun = new THREE.DirectionalLight(0xffffff, 1);
        sun.position.set(20, 40, 20);
        scene.add(sun);

        // --- GROUND & GRID ---
        const floor = new THREE.Mesh(new THREE.PlaneGeometry(500, 500), new THREE.MeshStandardMaterial({ color: 0x222233 }));
        floor.rotation.x = -Math.PI / 2;
        scene.add(floor);
        scene.add(new THREE.GridHelper(200, 40, 0x00f2ff, 0x333344));

        // --- PLAYER & JUMPING ---
        const player = new THREE.Group();
        const suit = new THREE.Mesh(new THREE.CapsuleGeometry(0.4, 0.8), new THREE.MeshStandardMaterial({color: 0xffffff}));
        suit.position.y = 0.9;
        player.add(suit);
        scene.add(player);

        let vY = 0, isJumping = false;
        const keys = {};
        window.addEventListener('keydown', (e) => {
            keys[e.code] = true;
            if(e.code === 'Space' && !isJumping) { vY = 0.35; isJumping = true; }
        });
        window.addEventListener('keyup', (e) => keys[e.code] = false);

        // --- CLICKER CRYSTAL ---
        const crystal = new THREE.Mesh(new THREE.OctahedronGeometry(1.2, 0), new THREE.MeshStandardMaterial({color: 0xffcc00, emissive: 0xffcc00, emissiveIntensity: 0.5}));
        crystal.position.set(0, 3, 0);
        scene.add(crystal);

        // --- TYCOON SYSTEM ---
        let money = 50;
        let income = 0;
        const buyPads = [];
        const labelContainer = document.getElementById('labels-container');

        function createBuyPad(x, z, cost, name, color, onPurchase) {
            const pad = new THREE.Group();
            const ring = new THREE.Mesh(new THREE.TorusGeometry(2, 0.15, 16, 32), new THREE.MeshBasicMaterial({color: color}));
            ring.rotation.x = Math.PI/2;
            pad.add(ring);
            pad.position.set(x, 0.1, z);
            
            // HTML Label
            const div = document.createElement('div');
            div.className = 'price-tag';
            div.innerHTML = `${name}<br>§${cost}`;
            labelContainer.appendChild(div);

            pad.userData = { cost, active: true, onPurchase, div };
            scene.add(pad);
            buyPads.push(pad);
        }

        // --- THE BUILD SEQUENCE (SPACE STATION CITY) ---
        // 1. Miner
        createBuyPad(10, 10, 50, "Auto-Miner", 0x00ff88, () => {
            income += 10;
            const tower = new THREE.Mesh(new THREE.CylinderGeometry(1.5, 2, 8), new THREE.MeshStandardMaterial({color: 0x555555}));
            tower.position.set(10, 4, 18);
            scene.add(tower);
            const light = new THREE.Mesh(new THREE.SphereGeometry(0.5), new THREE.MeshBasicMaterial({color: 0x00ff88}));
            light.position.set(10, 8.5, 18);
            scene.add(light);

            // 2. Solar Wing (Unlocks after Miner)
            createBuyPad(-10, 10, 250, "Solar Wing", 0xff0077, () => {
                income += 50;
                const wing = new THREE.Mesh(new THREE.BoxGeometry(10, 0.2, 4), new THREE.MeshStandardMaterial({color: 0x00f2ff}));
                wing.position.set(-15, 6, 15);
                wing.rotation.z = 0.5;
                scene.add(wing);

                // 3. Command Center (Unlocks after Wing)
                createBuyPad(0, 20, 1000, "Command Deck", 0xffcc00, () => {
                    income += 250;
                    const deck = new THREE.Mesh(new THREE.SphereGeometry(4, 32, 16, 0, Math.PI*2, 0, Math.PI/2), new THREE.MeshStandardMaterial({color: 0xeeeeee, transparent: true, opacity: 0.8}));
                    deck.position.set(0, 0, 25);
                    scene.add(deck);
                });
            });
        });

        // --- CLICK DETECTION ---
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();
        window.addEventListener('mousedown', (e) => {
            mouse.x = (e.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(e.clientY / window.innerHeight) * 2 + 1;
            raycaster.setFromCamera(mouse, camera);
            if(raycaster.intersectObject(crystal).length > 0) {
                money += 5;
                crystal.scale.set(1.4, 1.4, 1.4);
            }
        });

        // --- ANIMATION LOOP ---
        function animate() {
            requestAnimationFrame(animate);

            // Movement & Jump
            if(keys['KeyW']) player.translateZ(0.25);
            if(keys['KeyS']) player.translateZ(-0.25);
            if(keys['KeyA']) player.rotation.y += 0.05;
            if(keys['KeyD']) player.rotation.y -= 0.05;
            vY -= 0.015;
            player.position.y += vY;
            if(player.position.y <= 0) { player.position.y = 0; vY = 0; isJumping = false; }

            // Economy
            money += income / 60;
            document.getElementById('money').innerText = "§ " + Math.floor(money);
            document.getElementById('income').innerText = `Income: §${income}/sec`;
            crystal.rotation.y += 0.03;
            crystal.scale.lerp(new THREE.Vector3(1,1,1), 0.1);

            // Handle Pads & Labels
            buyPads.forEach(pad => {
                if(!pad.userData.active) return;

                // Position the HTML label over the pad
                const vector = pad.position.clone();
                vector.y += 2.5; // Hover above pad
                vector.project(camera);
                const x = (vector.x * 0.5 + 0.5) * window.innerWidth;
                const y = (vector.y * -0.5 + 0.5) * window.innerHeight;
                pad.userData.div.style.left = `${x}px`;
                pad.userData.div.style.top = `${y}px`;

                // Purchase Logic
                if(player.position.distanceTo(pad.position) < 2.2) {
                    if(money >= pad.userData.cost) {
                        money -= pad.userData.cost;
                        pad.userData.active = false;
                        pad.userData.div.style.display = 'none';
                        scene.remove(pad);
                        pad.userData.onPurchase();
                    }
                }
            });

            // Camera follow
            const camPos = new THREE.Vector3(0, 7, -15).applyMatrix4(player.matrixWorld);
            camera.position.lerp(camPos, 0.1);
            camera.lookAt(player.position);

            renderer.render(scene, camera);
        }
        animate();

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
